package myarchive;


import wsiarchive.*;

// Liste von archiv mit dem resultlistCache
public class PairArchiveAndPutResultList implements IArchiveAndPutResultList {
    IArchive archive; // ein archiv
    IPutResultList resultlist; // quasie der Cache
    IArchiveAndPutResultList rest;

    PairArchiveAndItemIDList(IArchive archive, IPutResultList resultlist, IArchiveAndItemIDList rest) {
        this.archive = archive;
        this.resultlist = resultlist;
        this.rest = rest;
    }
    
    // versucht ein item in ein archiv oder den rest zu schreiben
    public IPutResult put(Item item) {
        IPutResult putresult = this.archive.put(item);
        if (putresult instanceof FullPutResult) {
            return this.rest.put(item);
        }
        else {
            // Aktualisiere den Cache
            this.resultlist.addPutResult(putresult);
            return putresult;
        }
    }
    
    public IGetResult get(IItemId id) {
        // Falls wir ein resultat m
        IGetResult getresult = this.getCache(id);
        if (getresult instanceof FullPutResult) {
            return this.getRekursiv(id);
        }
        else {
            return getresult;
        }
    }
    
    // Versucht ein item ohne benutzern des caches zu bekommen
    public IGetResult getRekursiv(IItemId id) {
        IGetResult getresult = this.archive.get(id);
        if (getresult instanceof FullPutResult) {
            return this.rest.getRekursiv(id);
        }
        else {
            // @TODO write in resultlist
            // this.resultlist.addGetResult(getresult);
            return getresult;
        }
    }
    
    // Versucht ein item mit Benutzen des Caches zu bekommen
    public IGetResult getCache(IItemId id) {
        if (this.resultlist.isItemIdIn(id)) {
            return this.archive.get(id);
        }
        else {
            IGetResult getresult = this.rest.getCache(id);
        }
    }
}
